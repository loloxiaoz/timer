_env:
    - !R.env
        _name    : "define"
        _res :
            - !R.vars
                PRJ_NAME    : "mara_match"
            - !R.include
                _path :
                    - "/data/x/etc/mara_env/rigger/mara_v2.yaml"

    - !R.env
        _name : "base"
        _mix  : "_base"
        _res :
            - !R.vars
                BASE_INCLUDE : "${PRJ_ROOT}/src/bizlogic:${SDKS_PATH}:${MARA_LIBS}"
                CONF_FILE    : "/data/x/etc/env_conf/projects/match.json"
                PORT         : "8086"

    - !R.env
        _name    : "dev"
        _mix     : "define,_local_deploy,_dev,base"
        _res :
            - !R.vars
                BASE_DOMAIN         : "cron.${USER}.dev.mararun.cn"
                MARA_SDKS           : "${HOME}/devspace/mara_sdks/src"

    - !R.env
        _name    : "ci"
        _mix     : "define,_ci_deploy,_ci,base"
        _res :
            - !R.vars
                BASE_DOMAIN         : "match.ci.mararun.cn"
                MARA_SDKS           : "/data/jenkins/workspace/mara_sdks/src"

    - !R.env
        _name    : "lab"
        _mix     : "define,_project_deploy,_lab,base"
        _res :
            - !R.vars
                BASE_DOMAIN         : "match.lab.mararun.cn"

    - !R.env
        _name    : "demo"
        _mix     : "define,_project_deploy,_demo,base"
        _res :
            - !R.vars
                BASE_DOMAIN         : "match.demo.mararun.cn"

    - !R.env
        _name    : "test"
        _mix     : "define,_project_deploy,_test,base"
        _res :
            - !R.vars
                BASE_DOMAIN         : "match.test.mararun.cn"

    - !R.env
        _name    : "beta"
        _mix     : "define,_project_deploy,_beta,base"
        _res :
            - !R.vars
                _json             : "${CONF_FILE}:/match/mara/online"
                BASE_DOMAIN       : "match.beta.mararun.cn"

    - !R.env
        _name    : "online"
        _mix     : "define,_project_deploy,_online,base"
        _res :
            - !R.vars
                _json       : "${CONF_FILE}:/match/mara/online"
                BASE_DOMAIN : "match.mararun.cn"

_sys:
    -  !R.system
        _name : "api"
        _res  :
            - !R.vars
                DOMAIN      : "api.${BASE_DOMAIN}"
            - !R.using
                modul : "mara_api"
                args  : !R.vars
                    API_ENTRY    : "${PRJ_ROOT}/src/sys_${SYS_NAME}"
                    INCLUDE_PATH : "${prj_root}/src/sys_${sys_name}:${BASE_INCLUDE}"

    -  !R.system
        _name : "test"
        _res:
            - !R.vars
                API_DOMAIN  : "api.${BASE_DOMAIN}"
                PHP_INI : "${PRJ_ROOT}/conf/used/test_php.ini"
            - !R.using
                modul : "mara_unit"
                args  : !R.vars
                    INCLUDE_PATH: "${prj_root}/src/sys_api:${BASE_INCLUDE}:${PRJ_ROOT}/test/"

    -  !R.system
        _name : "console"
        _res:
            - !R.vars
                PHP_INI : "${PRJ_ROOT}/conf/used/console_php.ini"
            - !R.using
                modul : "mara_php"
                args  : !R.vars
                    INCLUDE_PATH : "${PRJ_ROOT}/src/sys_console:${BASE_INCLUDE}"
            - !R.daemon_php
                script:  "${PRJ_ROOT}/src/sys_console/apply_worker.php"
                tag   :  "apply"
                worker:  5
            - !R.daemon_php
                script:  "${PRJ_ROOT}/src/sys_console/pay_worker.php"
                tag   :  "pay"
            - !R.daemon_php
                script:  "${PRJ_ROOT}/src/sys_console/supervise_worker.php"
                tag   :  "check"
            - !R.file_tpl
                tpl   : "${PRJ_ROOT}/conf/options/console.cron"
                dst   : "${PRJ_ROOT}/conf/used/console.cron"
                    #            - !R.crontab
                    #                key   : "match_crontab"
                    #                cron  : "${PRJ_ROOT}/conf/used/console.cron"
